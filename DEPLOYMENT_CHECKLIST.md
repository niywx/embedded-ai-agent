# ✅ 服务器部署检查清单

## 📋 部署前准备 (Pre-Deployment)

### 服务器信息
- [ ] 服务器 IP 地址: ___________________
- [ ] SSH 用户名: ___________________
- [ ] SSH 端口: ___________________
- [ ] 服务器操作系统: ___________________
- [ ] 服务器配置:
  - [ ] CPU 核心数: ___________________
  - [ ] 内存大小: ___________________  (建议 ≥2GB)
  - [ ] 磁盘空间: ___________________  (建议 ≥5GB)

### API 配置
- [ ] Qwen API Key: ___________________
- [ ] Qwen API Base: `https://dashscope.aliyuncs.com/compatible-mode/v1`
- [ ] API 端口: ___________________  (默认 8080)
- [ ] Web 端口: ___________________  (默认 3000)

### 网络配置
- [ ] 服务器可从本地 SSH 访问
- [ ] 防火墙规则已配置 (或准备配置)
- [ ] 如需外网访问,已配置公网 IP/域名
- [ ] 如需 HTTPS,已准备域名和证书

---

## 🚀 部署执行 (Deployment)

### 步骤 1: 上传项目
- [ ] 使用 `upload_to_server.ps1` 上传成功
- [ ] 或使用 `scp`/`git clone` 上传成功
- [ ] 项目目录: `~/embedded-ai-agent`

### 步骤 2: 运行部署脚本
```bash
cd ~/embedded-ai-agent
chmod +x deploy.sh
./deploy.sh
```

部署脚本执行情况:
- [ ] 系统环境检查通过
- [ ] 磁盘空间检查通过 (≥2GB)
- [ ] 内存检查通过 (建议 ≥2GB)
- [ ] 系统依赖安装成功:
  - [ ] curl
  - [ ] git
  - [ ] tesseract-ocr
  - [ ] imagemagick
  - [ ] build-essential
- [ ] Node.js 18+ 安装成功
- [ ] npm 依赖安装完成
- [ ] .env 文件创建成功
- [ ] 必要目录创建成功 (temp/, out/, logs/)
- [ ] 防火墙配置完成 (如需要)
- [ ] PM2 安装和配置成功
- [ ] ecosystem.config.js 创建成功
- [ ] 服务启动成功
- [ ] PM2 开机自启配置完成

部署脚本输出:
```
记录部署脚本的最后几行输出:
___________________________________________________________
___________________________________________________________
___________________________________________________________
```

---

## ✔️ 部署验证 (Verification)

### 系统检查
```bash
./health_check.sh
```

- [ ] CPU 使用率 < 80%: _______%
- [ ] 内存使用率 < 80%: _______%
- [ ] 磁盘使用率 < 85%: _______%
- [ ] PM2 服务状态: 
  - [ ] embedded-ai-api: `online`
  - [ ] embedded-ai-web: `online`
- [ ] 端口监听正常:
  - [ ] API 端口 (8080): 监听中
  - [ ] Web 端口 (3000): 监听中

### 依赖检查
- [ ] Node.js 版本: ___________________  (≥18.0.0)
- [ ] npm 版本: ___________________
- [ ] PM2 版本: ___________________
- [ ] Tesseract 版本: ___________________
- [ ] ImageMagick 版本: ___________________

### 环境变量检查
- [ ] .env 文件存在
- [ ] QWEN_API_KEY 已配置且不为空
- [ ] QWEN_API_BASE 已配置
- [ ] PORT 已配置
- [ ] .env 文件权限为 600

### 目录检查
- [ ] temp/ 目录存在且可写
- [ ] out/ 目录存在且可写
- [ ] logs/ 目录存在且可写
- [ ] node_modules/ 目录存在

---

## 🧪 功能测试 (Testing)

### API 健康检查
```bash
curl http://localhost:8080/api/v1/health
```
- [ ] 返回 HTTP 200
- [ ] 响应内容: `{"status":"ok"}`

### API 工具检查
```bash
curl http://localhost:8080/api/v1/tools
```
- [ ] 返回 HTTP 200
- [ ] 包含 Tesseract 信息
- [ ] 包含 ImageMagick 信息

### Web 服务检查
```bash
curl -I http://localhost:3000
```
- [ ] 返回 HTTP 200/301/302
- [ ] Web 界面可访问

### 完整功能测试
准备测试文件:
- [ ] 测试用 datasheet PDF: ___________________
- [ ] 测试用 schematic PDF/图片: ___________________

执行测试:
```bash
curl -X POST http://localhost:8080/api/v1/generate \
  -F "datasheet=@test-datasheet.pdf" \
  -F "schematic=@test-schematic.pdf" \
  -F "userPrompt=Generate I2C driver code"
```

测试结果:
- [ ] 文件上传成功
- [ ] 返回 task_id
- [ ] 任务状态可查询
- [ ] 代码生成成功
- [ ] 生成的 .c 文件在 out/ 目录
- [ ] 生成的代码可编译 (可选测试)

生成的文件:
- [ ] 文件名: ___________________
- [ ] 文件大小: ___________________
- [ ] 文件内容正常 (无明显错误)

---

## 📊 性能测试 (Performance)

### 服务资源使用
```bash
pm2 monit
```
- [ ] API 服务内存使用: _______ MB  (< 1GB)
- [ ] Web 服务内存使用: _______ MB  (< 500MB)
- [ ] API 服务 CPU 使用: _______% (平均)
- [ ] 服务重启次数: _______  (应为 0)

### 日志检查
```bash
pm2 logs --lines 50
```
- [ ] 无严重错误 (ERROR)
- [ ] 无频繁警告 (WARN)
- [ ] 启动日志正常

### 生成性能
- [ ] 单次代码生成时间: _______ 秒
- [ ] 是否在可接受范围内 (< 60秒)

---

## 🔒 安全配置 (Security)

### 文件权限
```bash
ls -lh .env ecosystem.config.js
```
- [ ] .env 权限为 600 (rw-------)
- [ ] 其他配置文件权限正常

### 防火墙
- [ ] 防火墙已配置 (ufw 或 firewalld)
- [ ] 只开放必要端口:
  - [ ] 22 (SSH)
  - [ ] 8080 (API)
  - [ ] 3000 (Web)
- [ ] 如不需要外网访问,已限制访问源

### 服务安全
- [ ] 服务以非 root 用户运行
- [ ] PM2 配置了内存限制
- [ ] 日志文件有大小/数量限制

---

## 📝 备份配置 (Backup)

### 手动备份
```bash
./backup.sh
```
- [ ] 备份脚本执行成功
- [ ] 备份文件已创建: ___________________
- [ ] 备份文件大小: ___________________
- [ ] 备份位置: `~/embedded-ai-backups/`

### 自动备份 (可选)
```bash
crontab -e
```
- [ ] 已配置 cron 任务
- [ ] 备份频率: ___________________  (建议每天)
- [ ] 备份时间: ___________________  (建议凌晨)

Cron 任务配置:
```
0 2 * * * cd ~/embedded-ai-agent && ./backup.sh >> logs/backup.log 2>&1
```

---

## 🌐 外网访问 (Optional)

如需外网访问:

### Nginx 反向代理
- [ ] Nginx 已安装
- [ ] 配置文件已创建: `/etc/nginx/sites-available/embedded-ai`
- [ ] 配置已启用: 软链接到 `sites-enabled`
- [ ] Nginx 配置测试通过: `nginx -t`
- [ ] Nginx 已重启: `systemctl reload nginx`

### HTTPS 配置
- [ ] 域名已配置: ___________________
- [ ] DNS 已生效
- [ ] Certbot 已安装
- [ ] SSL 证书已申请
- [ ] HTTPS 可正常访问

访问地址:
- API: https://___________________/api/
- Web: https://___________________/

---

## 📚 文档归档 (Documentation)

### 部署信息记录
- [ ] 部署日期: ___________________
- [ ] 部署人员: ___________________
- [ ] 项目版本: ___________________
- [ ] Node.js 版本: ___________________
- [ ] 部署方式: [ ] PM2  [ ] systemd  [ ] Docker

### 配置信息存档
- [ ] .env 文件已备份到安全位置
- [ ] ecosystem.config.js 已备份
- [ ] Nginx 配置已备份 (如有)
- [ ] SSH 密钥已备份 (如有)

### 运维文档
- [ ] 团队成员已知晓服务器信息
- [ ] 运维手册已归档
- [ ] 故障联系人已确定: ___________________

---

## 🎓 培训交接 (Training)

### 团队成员培训
- [ ] 如何 SSH 登录服务器
- [ ] 如何查看服务状态 (`pm2 list`)
- [ ] 如何查看日志 (`pm2 logs`)
- [ ] 如何重启服务 (`pm2 restart`)
- [ ] 如何运行健康检查 (`./health_check.sh`)
- [ ] 如何执行备份 (`./backup.sh`)
- [ ] 如何恢复数据 (`./restore.sh`)

### 应急响应
- [ ] 服务宕机时的处理流程
- [ ] API Key 失效时的更新流程
- [ ] 磁盘空间不足时的清理流程
- [ ] 内存溢出时的处理流程

---

## ✅ 最终签署 (Sign-off)

### 部署完成确认
- [ ] 所有关键功能测试通过
- [ ] 性能指标在可接受范围
- [ ] 安全配置已完成
- [ ] 备份策略已实施
- [ ] 文档已归档
- [ ] 团队已培训

### 签署
- 部署工程师: ___________________  日期: ___________________
- 测试人员: ___________________  日期: ___________________
- 项目负责人: ___________________  日期: ___________________

---

## 📞 支持联系方式

### 技术支持
- 一线支持: ___________________
- 二线支持: ___________________
- 紧急联系: ___________________

### 相关资源
- 项目文档: `README.md`
- 部署指南: `DEPLOYMENT_GUIDE.md`
- 快速开始: `QUICK_START.md`
- 故障排查: `TROUBLESHOOTING.md`
- GitHub: ___________________

---

**部署检查清单完成日期**: ___________________

**备注**: 
___________________________________________________________
___________________________________________________________
___________________________________________________________
